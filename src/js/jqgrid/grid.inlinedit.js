(function(b){b.jgrid.extend({editRow:function(q,k,l,a,r,o,p,n,m){return this.each(function(){var g=this,t,f,i,h=0,c=null,d={},j,e;if(!g.grid){return}j=b(g).jqGrid("getInd",q,true);if(j===false){return}i=b(j).attr("editable")||"0";if(i=="0"&&!b(j).hasClass("not-editable-row")){e=g.p.colModel;b("td",j).each(function(s){t=e[s].name;var z=g.p.treeGrid===true&&t==g.p.ExpandColumn;if(z){f=b("span:first",this).html()}else{try{f=b.unformat(this,{rowId:q,colModel:e[s]},s)}catch(y){f=b(this).html()}}if(t!="cb"&&t!="subgrid"&&t!="rn"){if(g.p.autoencode){f=b.jgrid.htmlDecode(f)}d[t]=f;if(e[s].editable===true){if(c===null){c=s}if(z){b("span:first",this).html("")}else{b(this).html("")}var B=b.extend({},e[s].editoptions||{},{id:q+"_"+t,name:t});if(!e[s].edittype){e[s].edittype="text"}var A=createEl(e[s].edittype,B,f,true,b.extend({},b.jgrid.ajaxOptions,g.p.ajaxSelectOptions||{}));b(A).addClass("editable");if(z){b("span:first",this).append(A)}else{b(this).append(A)}if(e[s].edittype=="select"&&e[s].editoptions.multiple===true&&b.browser.msie){b(A).width(b(A).width())}h++}}});if(h>0){d.id=q;g.p.savedRow.push(d);b(j).attr("editable","1");b("td:eq("+c+") input",j).focus();if(k===true){b(j).bind("keydown",function(s){if(s.keyCode===27){b(g).jqGrid("restoreRow",q,m)}if(s.keyCode===13){var v=s.target;if(v.tagName=="TEXTAREA"){return true}b(g).jqGrid("saveRow",q,a,r,o,p,n,m);return false}s.stopPropagation()})}if(b.isFunction(l)){l(q)}}}})},saveRow:function(j,k,m,l,a,i,n){return this.each(function(){var H=this,A,G={},h={},y,E,F,z;if(!H.grid){return}z=b(H).jqGrid("getInd",j,true);if(z===false){return}y=b(z).attr("editable");m=m?m:H.p.editurl;if(y==="1"){var B;b("td",z).each(function(q){B=H.p.colModel[q];A=B.name;if(A!="cb"&&A!="subgrid"&&B.editable===true&&A!="rn"){switch(B.edittype){case"checkbox":var s=["Yes","No"];if(B.editoptions){s=B.editoptions.value.split(":")}G[A]=b("input",this).attr("checked")?s[0]:s[1];break;case"text":case"password":case"textarea":case"button":G[A]=b("input, textarea",this).val();break;case"select":if(!B.editoptions.multiple){G[A]=b("select>option:selected",this).val();h[A]=b("select>option:selected",this).text()}else{var p=b("select",this),o=[];G[A]=b(p).val();if(G[A]){G[A]=G[A].join(",")}else{G[A]=""}b("select > option:selected",this).each(function(u,t){o[u]=b(t).text()});h[A]=o.join(",")}if(B.formatter&&B.formatter=="select"){h={}}break;case"custom":try{if(B.editoptions&&b.isFunction(B.editoptions.custom_value)){G[A]=B.editoptions.custom_value(b(".customelement",this),"get");if(G[A]===undefined){throw"e2"}}else{throw"e1"}}catch(r){if(r=="e1"){info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose)}if(r=="e2"){info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose)}else{info_dialog(jQuery.jgrid.errors.errcap,r.message,jQuery.jgrid.edit.bClose)}}break}F=checkValues(G[A],q,H);if(F[0]===false){F[1]=G[A]+" "+F[1];return false}if(H.p.autoencode){G[A]=b.jgrid.htmlEncode(G[A])}}});if(F[0]===false){try{var d=findPos(b("#"+b.jgrid.jqID(j),H.grid.bDiv)[0]);info_dialog(b.jgrid.errors.errcap,F[1],b.jgrid.edit.bClose,{left:d[0],top:d[1]})}catch(C){alert(F[1])}return}if(G){var D,e,c;e=H.p.prmNames;c=e.oper;D=e.id;G[c]=e.editoper;G[D]=j;if(typeof(H.p.inlineData)=="undefined"){H.p.inlineData={}}if(typeof(l)=="undefined"){l={}}G=b.extend({},G,H.p.inlineData,l)}if(m=="clientArray"){G=b.extend({},G,h);if(H.p.autoencode){b.each(G,function(p,o){G[p]=b.jgrid.htmlDecode(o)})}var f=b(H).jqGrid("setRowData",j,G);b(z).attr("editable","0");for(var g=0;g<H.p.savedRow.length;g++){if(H.p.savedRow[g].id==j){E=g;break}}if(E>=0){H.p.savedRow.splice(E,1)}if(b.isFunction(a)){a(j,f)}}else{b("#lui_"+H.p.id).show();b.ajax(b.extend({url:m,data:b.isFunction(H.p.serializeRowData)?H.p.serializeRowData(G):G,type:"POST",complete:function(r,p){b("#lui_"+H.p.id).hide();if(p==="success"){var q;if(b.isFunction(k)){q=k(r)}else{q=true}if(q===true){if(H.p.autoencode){b.each(G,function(t,s){G[t]=b.jgrid.htmlDecode(s)})}G=b.extend({},G,h);b(H).jqGrid("setRowData",j,G);b(z).attr("editable","0");for(var o=0;o<H.p.savedRow.length;o++){if(H.p.savedRow[o].id==j){E=o;break}}if(E>=0){H.p.savedRow.splice(E,1)}if(b.isFunction(a)){a(j,r)}}else{b(H).jqGrid("restoreRow",j,n)}}},error:function(o,p){b("#lui_"+H.p.id).hide();if(b.isFunction(i)){i(j,o,p)}else{alert("Error Row: "+j+" Result: "+o.status+":"+o.statusText+" Status: "+p)}b(H).jqGrid("restoreRow",j,n)}},b.jgrid.ajaxOptions,H.p.ajaxRowOptions||{}))}b(z).unbind("keydown")}})},restoreRow:function(d,a){return this.each(function(){var c=this,e,m,k={};if(!c.grid){return}m=b(c).jqGrid("getInd",d,true);if(m===false){return}for(var n=0;n<c.p.savedRow.length;n++){if(c.p.savedRow[n].id==d){e=n;break}}if(e>=0){if(b.isFunction(b.fn.datepicker)){try{b("input.hasDatepicker","#"+b.jgrid.jqID(m.id)).datepicker("hide")}catch(l){}}b.each(c.p.colModel,function(g,f){if(this.editable===true&&this.name in c.p.savedRow[e]){k[this.name]=c.p.savedRow[e][this.name]}});b(c).jqGrid("setRowData",d,k);b(m).attr("editable","0").unbind("keydown");c.p.savedRow.splice(e,1)}if(b.isFunction(a)){a(d)}})}})})(jQuery);
(function(b){b.jgrid.extend({groupingSetup:function(){return this.each(function(){var h=this,l=h.p.groupingView;if(l!==null&&isObject(l)){if(!l.groupField.length){h.p.grouping=false}else{for(var j=0;j<l.groupField.length;j++){if(!l.groupOrder[j]){l.groupOrder[j]="asc"}if(!l.groupText[j]){l.groupText[j]="{0}"}if(typeof(l.groupColumnShow[j])!="boolean"){l.groupColumnShow[j]=true}if(typeof(l.groupSummary[j])!="boolean"){l.groupSummary[j]=false}if(l.groupColumnShow[j]===true){b(h).jqGrid("showCol",l.groupField[j])}else{b(h).jqGrid("hideCol",l.groupField[j])}l.sortitems[j]=[];l.sortnames[j]=[];l.summaryval[j]=[];if(l.groupSummary[j]){l.summary[j]=[];var a=h.p.colModel;for(var k=0,i=a.length;k<i;k++){if(a[k].summaryType){l.summary[j].push({nm:a[k].name,st:a[k].summaryType,v:""})}}}}h.p.scroll=false;h.p.rownumbers=false;h.p.subGrid=false;h.p.treeGrid=false;h.p.gridview=true}}else{h.p.grouping=false}})},groupingPrepare:function(g,h,f,a){this.each(function(){var c=h[0]?h[0].split(" ").join(""):"";var e=this.p.groupingView,d=this;if(f.hasOwnProperty(c)){f[c].push(g)}else{f[c]=[];f[c].push(g);e.sortitems[0].push(c);e.sortnames[0].push(b.trim(h[0]));e.summaryval[0][c]=b.extend(true,{},e.summary[0])}if(e.groupSummary[0]){b.each(e.summaryval[0][c],function(l,i){if(b.isFunction(this.st)){this.v=this.st.call(d,this.v,this.nm,a)}else{this.v=b(d).jqGrid("groupingCalculations."+this.st,this.v,this.nm,a)}})}});return f},groupingToggle:function(a){this.each(function(){var i=a.lastIndexOf("_"),k=a.substring(0,i+1),l=parseInt(a.substring(i+1))+1,j=this.p.groupingView.minusicon,h=this.p.groupingView.plusicon;if(b("#"+a+" span").hasClass(j)){b("#"+a).nextUntil("#"+k+String(l)).hide();b("#"+a+" span").removeClass(j).addClass(h)}else{b("#"+a).nextUntil("#"+k+String(l)).show();b("#"+a+" span").removeClass(h).addClass(j)}});return false},groupingRender:function(a,d){return this.each(function(){var c=this,j=c.p.groupingView,k="",l="",m,n="";if(!j.groupDataSorted){j.sortitems[0].sort();j.sortnames[0].sort();if(j.groupOrder[0].toLowerCase()=="desc"){j.sortitems[0].reverse()}}if(j.groupCollapse){n=j.plusicon}else{n=j.minusicon}n+=" tree-wrap-"+c.p.direction;b.each(j.sortitems[0],function(g,i){m=c.p.id+"ghead_"+g;l="<span style='cursor:pointer;' class='ui-icon "+n+"' onclick=\"jQuery('#"+c.p.id+"').jqGrid('groupingToggle','"+m+"');return false;\"></span>";k+='<tr id="'+m+'" role="row" class= "ui-widget-content jqgroup ui-row-'+c.p.direction+'"><td colspan="'+d+'">'+l+b.jgrid.format(j.groupText[0],j.sortnames[0][g],a[i].length)+"</td></tr>";for(var z=0;z<a[i].length;z++){k+=a[i][z].join("")}if(j.groupSummary[0]){var e="";if(j.groupCollapse){e=' style="display:none;"'}k+="<tr"+e+' role="row" class="ui-widget-content jqfoot ui-row-'+c.p.direction+'">';var f=j.summaryval[0][i],w=c.p.colModel,x,y,v=a[i].length;for(var h=0;h<d;h++){var A="<td "+c.formatCol(h,1,"")+">&#160;</td>",B="{0}";b.each(f,function(){if(this.nm==w[h].name){if(w[h].summaryTpl){B=w[h].summaryTpl}if(this.st=="avg"){if(this.v&&v>0){this.v=(this.v/v)}}try{y=c.formatter("",this.v,h,this)}catch(o){y=this.v}A="<td "+c.formatCol(h,1,"")+">"+b.jgrid.format(B,y)+"</td>";return false}});k+=A}k+="</tr>"}});b("#"+c.p.id+" tbody:first").append(k);k=null;j.sortitems[0]=[];j.sortnames[0]=[];j.summaryval[0]=[]})},groupingGroupBy:function(f,a,e){return this.each(function(){var c=this;if(typeof(f)=="string"){f=[f]}var h=c.p.groupingView;c.p.grouping=true;for(var d=0;d<h.groupField.length;d++){if(!h.groupColumnShow[d]){b(c).jqGrid("showCol",h.groupField[d])}}c.p.groupingView=b.extend(c.p.groupingView,a||{});h.groupField=f;b(c).trigger("reloadGrid")})},groupingRemove:function(a){return this.each(function(){var d=this;if(typeof(a)=="undefined"){a=true}d.p.grouping=false;if(a===true){b("tr.jqgroup, tr.jqfoot","#"+d.p.id+" tbody:first").remove()}else{b(d).trigger("reloadGrid")}})},groupingCalculations:{sum:function(a,e,f){return parseFloat(a||0)+parseFloat((f[e]||0))},min:function(a,e,f){if(a===""){return parseFloat(f[e]||0)}return Math.min(parseFloat(a),parseFloat(f[e]||0))},max:function(a,e,f){if(a===""){return parseFloat(f[e]||0)}return Math.max(parseFloat(a),parseFloat(f[e]||0))},count:function(a,e,f){if(a===""){a=0}if(f.hasOwnProperty(e)){return a=a+1}else{return 0}},avg:function(a,e,f){return parseFloat(a||0)+parseFloat((f[e]||0))}}})})(jQuery);
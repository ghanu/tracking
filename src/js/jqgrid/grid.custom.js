(function(b){b.jgrid.extend({getColProp:function(i){var a={},g=this[0];if(!g.grid){return}var h=g.p.colModel;for(var j=0;j<h.length;j++){if(h[j].name==i){a=h[j];break}}return a},setColProp:function(d,a){return this.each(function(){if(this.grid){if(a){var c=this.p.colModel;for(var f=0;f<c.length;f++){if(c[f].name==d){b.extend(this.p.colModel[f],a);break}}}}})},sortGrid:function(f,a,e){return this.each(function(){var c=this,j=-1;if(!c.grid){return}if(!f){f=c.p.sortname}for(var d=0;d<c.p.colModel.length;d++){if(c.p.colModel[d].index==f||c.p.colModel[d].name==f){j=d;break}}if(j!=-1){var i=c.p.colModel[j].sortable;if(typeof i!=="boolean"){i=true}if(typeof a!=="boolean"){a=false}if(i){c.sortData("jqgh_"+f,j,a,e)}}})},GridDestroy:function(){return this.each(function(){if(this.grid){if(this.p.pager){b(this.p.pager).remove()}var d=this.id;try{b("#gbox_"+d).remove()}catch(a){}}})},GridUnload:function(){return this.each(function(){if(!this.grid){return}var e={id:b(this).attr("id"),cl:b(this).attr("class")};if(this.p.pager){b(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom")}var a=document.createElement("table");b(a).attr({id:e.id});a.className=e.cl;var f=this.id;b(a).removeClass("ui-jqgrid-btable");if(b(this.p.pager).parents("#gbox_"+f).length===1){b(a).insertBefore("#gbox_"+f).show();b(this.p.pager).insertBefore("#gbox_"+f)}else{b(a).insertBefore("#gbox_"+f).show()}b("#gbox_"+f).remove()})},setGridState:function(a){return this.each(function(){if(!this.grid){return}var d=this;if(a=="hidden"){b(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+d.p.id).slideUp("fast");if(d.p.pager){b(d.p.pager).slideUp("fast")}if(d.p.toppager){b(d.p.toppager).slideUp("fast")}if(d.p.toolbar[0]===true){if(d.p.toolbar[1]=="both"){b(d.grid.ubDiv).slideUp("fast")}b(d.grid.uDiv).slideUp("fast")}if(d.p.footerrow){b(".ui-jqgrid-sdiv","#gbox_"+d.p.id).slideUp("fast")}b(".ui-jqgrid-titlebar-close span",d.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");d.p.gridstate="hidden"}else{if(a=="visible"){b(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+d.p.id).slideDown("fast");if(d.p.pager){b(d.p.pager).slideDown("fast")}if(d.p.toppager){b(d.p.toppager).slideDown("fast")}if(d.p.toolbar[0]===true){if(d.p.toolbar[1]=="both"){b(d.grid.ubDiv).slideDown("fast")}b(d.grid.uDiv).slideDown("fast")}if(d.p.footerrow){b(".ui-jqgrid-sdiv","#gbox_"+d.p.id).slideDown("fast")}b(".ui-jqgrid-titlebar-close span",d.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");d.p.gridstate="visible"}}})},updateGridRows:function(j,l,k){var a,h=false,i;this.each(function(){var f=this,d,c,e,g;if(!f.grid){return false}if(!l){l="id"}if(j&&j.length>0){b(j).each(function(o){e=this;c=f.rows.namedItem(e[l]);if(c){g=e[l];if(k===true){if(f.p.jsonReader.repeatitems===true){if(f.p.jsonReader.cell){e=e[f.p.jsonReader.cell]}for(var p=0;p<e.length;p++){d=f.formatter(g,e[p],p,e,"edit");i=f.p.colModel[p].title?{title:b.jgrid.stripHtml(d)}:{};if(f.p.treeGrid===true&&a==f.p.ExpandColumn){b("td:eq("+p+") > span:first",c).html(d).attr(i)}else{b("td:eq("+p+")",c).html(d).attr(i)}}h=true;return true}}b(f.p.colModel).each(function(m){a=k===true?this.jsonmap||this.name:this.name;if(e[a]!==undefined){d=f.formatter(g,e[a],m,e,"edit");i=this.title?{title:b.jgrid.stripHtml(d)}:{};if(f.p.treeGrid===true&&a==f.p.ExpandColumn){b("td:eq("+m+") > span:first",c).html(d).attr(i)}else{b("td:eq("+m+")",c).html(d).attr(i)}h=true}})}})}});return h},filterGrid:function(d,a){a=b.extend({gridModel:false,gridNames:false,gridToolbar:false,filterModel:[],formtype:"horizontal",autosearch:true,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:false,enableClear:false,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:"",marksearched:true},a||{});return this.each(function(){var n=this;this.p=a;if(this.p.filterModel.length===0&&this.p.gridModel===false){alert("No filter is set");return}if(!d){alert("No target grid is set!");return}this.p.gridid=d.indexOf("#")!=-1?d:"#"+d;var m=b(this.p.gridid).jqGrid("getGridParam","colModel");if(m){if(this.p.gridModel===true){var c=b(this.p.gridid)[0];var s;b.each(m,function(e,g){var f=[];this.search=this.search===false?false:true;if(this.editrules&&this.editrules.searchhidden===true){s=true}else{if(this.hidden===true){s=false}else{s=true}}if(this.search===true&&s===true){if(n.p.gridNames===true){f.label=c.p.colNames[e]}else{f.label=""}f.name=this.name;f.index=this.index||this.name;f.stype=this.edittype||"text";if(f.stype!="select"){f.stype="text"}f.defval=this.defval||"";f.surl=this.surl||"";f.sopt=this.editoptions||{};f.width=this.width;n.p.filterModel.push(f)}})}else{b.each(n.p.filterModel,function(e,g){for(var f=0;f<m.length;f++){if(this.name==m[f].name){this.index=m[f].index||this.name;break}}if(!this.index){this.index=this.name}})}}else{alert("Could not get grid colModel");return}var r=function(){var i={},j=0,e;var k=b(n.p.gridid)[0],f;k.p.searchdata={};if(b.isFunction(n.p.beforeSearch)){n.p.beforeSearch()}b.each(n.p.filterModel,function(x,l){f=this.index;switch(this.stype){case"select":e=b("select[name="+f+"]",n).val();if(e){i[f]=e;if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).addClass("dirty-cell")}j++}else{if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).removeClass("dirty-cell")}try{delete k.p.postData[this.index]}catch(w){}}break;default:e=b("input[name="+f+"]",n).val();if(e){i[f]=e;if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).addClass("dirty-cell")}j++}else{if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).removeClass("dirty-cell")}try{delete k.p.postData[this.index]}catch(w){}}}});var h=j>0?true:false;b.extend(k.p.postData,i);var g;if(n.p.url){g=b(k).jqGrid("getGridParam","url");b(k).jqGrid("setGridParam",{url:n.p.url})}b(k).jqGrid("setGridParam",{search:h}).trigger("reloadGrid",[{page:1}]);if(g){b(k).jqGrid("setGridParam",{url:g})}if(b.isFunction(n.p.afterSearch)){n.p.afterSearch()}};var o=function(){var i={},e,j=0;var k=b(n.p.gridid)[0],f;if(b.isFunction(n.p.beforeClear)){n.p.beforeClear()}b.each(n.p.filterModel,function(x,y){f=this.index;e=(this.defval)?this.defval:"";if(!this.stype){this.stype="text"}switch(this.stype){case"select":var z;b("select[name="+f+"] option",n).each(function(u){if(u===0){this.selected=true}if(b(this).text()==e){this.selected=true;z=b(this).val();return false}});if(z){i[f]=z;if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).addClass("dirty-cell")}j++}else{if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).removeClass("dirty-cell")}try{delete k.p.postData[this.index]}catch(l){}}break;case"text":b("input[name="+f+"]",n).val(e);if(e){i[f]=e;if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).addClass("dirty-cell")}j++}else{if(n.p.marksearched){b("#jqgh_"+this.name,k.grid.hDiv).removeClass("dirty-cell")}try{delete k.p.postData[this.index]}catch(l){}}break}});var h=j>0?true:false;b.extend(k.p.postData,i);var g;if(n.p.url){g=b(k).jqGrid("getGridParam","url");b(k).jqGrid("setGridParam",{url:n.p.url})}b(k).jqGrid("setGridParam",{search:h}).trigger("reloadGrid",[{page:1}]);if(g){b(k).jqGrid("setGridParam",{url:g})}if(b.isFunction(n.p.afterClear)){n.p.afterClear()}};var q=function(){var i=document.createElement("tr");var e,g,f,j,h;if(n.p.formtype=="horizontal"){b(t).append(i)}b.each(n.p.filterModel,function(k,G){j=document.createElement("td");b(j).append("<label for='"+this.name+"'>"+this.label+"</label>");h=document.createElement("td");var l=this;if(!this.stype){this.stype="text"}switch(this.stype){case"select":if(this.surl){b(h).load(this.surl,function(){if(l.defval){b("select",this).val(l.defval)}b("select",this).attr({name:l.index||l.name,id:"sg_"+l.name});if(l.sopt){b("select",this).attr(l.sopt)}if(n.p.gridToolbar===true&&l.width){b("select",this).width(l.width)}if(n.p.autosearch===true){b("select",this).change(function(u){r();return false})}})}else{if(l.sopt.value){var I=l.sopt.value;var F=document.createElement("select");b(F).attr({name:l.index||l.name,id:"sg_"+l.name}).attr(l.sopt);var H,J,E;if(typeof I==="string"){H=I.split(";");for(var D=0;D<H.length;D++){J=H[D].split(":");E=document.createElement("option");E.value=J[0];E.innerHTML=J[1];if(J[1]==l.defval){E.selected="selected"}F.appendChild(E)}}else{if(typeof I==="object"){for(var K in I){if(I.hasOwnProperty(K)){k++;E=document.createElement("option");E.value=K;E.innerHTML=I[K];if(I[K]==l.defval){E.selected="selected"}F.appendChild(E)}}}}if(n.p.gridToolbar===true&&l.width){b(F).width(l.width)}b(h).append(F);if(n.p.autosearch===true){b(F).change(function(u){r();return false})}}}break;case"text":var L=this.defval?this.defval:"";b(h).append("<input type='text' name='"+(this.index||this.name)+"' id='sg_"+this.name+"' value='"+L+"'/>");if(l.sopt){b("input",h).attr(l.sopt)}if(n.p.gridToolbar===true&&l.width){if(b.browser.msie){b("input",h).width(l.width-4)}else{b("input",h).width(l.width-2)}}if(n.p.autosearch===true){b("input",h).keypress(function(u){var v=u.charCode?u.charCode:u.keyCode?u.keyCode:0;if(v==13){r();return false}return this})}break}if(n.p.formtype=="horizontal"){if(n.p.gridToolbar===true&&n.p.gridNames===false){b(i).append(h)}else{b(i).append(j).append(h)}b(i).append(h)}else{e=document.createElement("tr");b(e).append(j).append(h);b(t).append(e)}});h=document.createElement("td");if(n.p.enableSearch===true){g="<input type='button' id='sButton' class='"+n.p.buttonclass+"' value='"+n.p.searchButton+"'/>";b(h).append(g);b("input#sButton",h).click(function(){r();return false})}if(n.p.enableClear===true){f="<input type='button' id='cButton' class='"+n.p.buttonclass+"' value='"+n.p.clearButton+"'/>";b(h).append(f);b("input#cButton",h).click(function(){o();return false})}if(n.p.enableClear===true||n.p.enableSearch===true){if(n.p.formtype=="horizontal"){b(i).append(h)}else{e=document.createElement("tr");b(e).append("<td>&#160;</td>").append(h);b(t).append(e)}}};var p=b("<form name='SearchForm' style=display:inline;' class='"+this.p.formclass+"'></form>");var t=b("<table class='"+this.p.tableclass+"' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>");b(p).append(t);q();b(this).append(p);this.triggerSearch=r;this.clearSearch=o})},filterToolbar:function(a){a=b.extend({autosearch:true,searchOnEnter:true,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:false,groupOp:"AND"},a||{});return this.each(function(){var m=this;var l=function(){var i={},t=0,d,c,v={};b.each(m.p.colModel,function(y,q){c=this.index||this.name;var r=(this.searchoptions&&this.searchoptions.sopt)?this.searchoptions.sopt[0]:"bw";switch(this.stype){case"select":d=b("select[name="+c+"]",m.grid.hDiv).val();if(d){i[c]=d;v[c]=r;t++}else{try{delete m.p.postData[c]}catch(s){}}break;case"text":d=b("input[name="+c+"]",m.grid.hDiv).val();if(d){i[c]=d;v[c]=r;t++}else{try{delete m.p.postData[c]}catch(s){}}break}});var f=t>0?true:false;if(a.stringResult===true||m.p.datatype=="local"){var e='{"groupOp":"'+a.groupOp+'","rules":[';var g=0;b.each(i,function(r,q){if(g>0){e+=","}e+='{"field":"'+r+'",';e+='"op":"'+v[r]+'",';e+='"data":"'+q+'"}';g++});e+="]}";b.extend(m.p.postData,{filters:e})}else{b.extend(m.p.postData,i)}var h;if(m.p.searchurl){h=m.p.url;b(m).jqGrid("setGridParam",{url:m.p.searchurl})}var u=false;if(b.isFunction(a.beforeSearch)){u=a.beforeSearch.call(m)}if(!u){b(m).jqGrid("setGridParam",{search:f}).trigger("reloadGrid",[{page:1}])}if(h){b(m).jqGrid("setGridParam",{url:h})}if(b.isFunction(a.afterSearch)){a.afterSearch()}};var o=function(v){var t={},d,u=0,c;v=(typeof v!="boolean")?true:v;b.each(m.p.colModel,function(y,q){d=(this.searchoptions&&this.searchoptions.defaultValue)?this.searchoptions.defaultValue:"";c=this.index||this.name;switch(this.stype){case"select":var r;b("select[name="+c+"] option",m.grid.hDiv).each(function(w){if(w===0){this.selected=true}if(b(this).text()==d){this.selected=true;r=b(this).val();return false}});if(r){t[c]=r;u++}else{try{delete m.p.postData[c]}catch(s){}}break;case"text":b("input[name="+c+"]",m.grid.hDiv).val(d);if(d){t[c]=d;u++}else{try{delete m.p.postData[c]}catch(s){}}break}});var g=u>0?true:false;if(a.stringResult===true||m.p.datatype=="local"){var f='{"groupOp":"'+a.groupOp+'","rules":[';var h=0;b.each(t,function(r,q){if(h>0){f+=","}f+='{"field":"'+r+'",';f+='"op":"eq",';f+='"data":"'+q+'"}';h++});f+="]}";b.extend(m.p.postData,{filters:f})}else{b.extend(m.p.postData,t)}var i;if(m.p.searchurl){i=m.p.url;b(m).jqGrid("setGridParam",{url:m.p.searchurl})}var e=false;if(b.isFunction(a.beforeClear)){e=a.beforeClear.call(m)}if(!e){if(v){b(m).jqGrid("setGridParam",{search:g}).trigger("reloadGrid",[{page:1}])}}if(i){b(m).jqGrid("setGridParam",{url:i})}if(b.isFunction(a.afterClear)){a.afterClear()}};var j=function(){var c=b("tr.ui-search-toolbar",m.grid.hDiv);if(c.css("display")=="none"){c.show()}else{c.hide()}};function n(e,c){var d=b(e);if(d[0]){jQuery.each(c,function(){if(this.data!==undefined){d.bind(this.type,this.data,this.fn)}else{d.bind(this.type,this.fn)}})}}var p=b("<tr class='ui-search-toolbar' role='rowheader'></tr>");var k;b.each(m.p.colModel,function(E,d){var B=this,D,g,G,i,f;g=b("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+m.p.direction+"'></th>");D=b("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'></div>");if(this.hidden===true){b(g).css("display","none")}this.search=this.search===false?false:true;if(typeof this.stype=="undefined"){this.stype="text"}G=b.extend({},this.searchoptions||{});if(this.search){switch(this.stype){case"select":i=this.surl||G.dataUrl;if(i){f=D;b.ajax(b.extend({url:i,dataType:"html",complete:function(r,s){if(G.buildSelect!==undefined){var q=G.buildSelect(r);if(q){b(f).append(q)}}else{b(f).append(r.responseText)}if(G.defaultValue){b("select",f).val(G.defaultValue)}b("select",f).attr({name:B.index||B.name,id:"gs_"+B.name});if(G.attr){b("select",f).attr(G.attr)}b("select",f).css({width:"100%"});if(G.dataInit!==undefined){G.dataInit(b("select",f)[0])}if(G.dataEvents!==undefined){n(b("select",f)[0],G.dataEvents)}if(a.autosearch===true){b("select",f).change(function(t){l();return false})}r=null}},b.jgrid.ajaxOptions,m.p.ajaxSelectOptions||{}))}else{var h;if(B.searchoptions&&B.searchoptions.value){h=B.searchoptions.value}else{if(B.editoptions&&B.editoptions.value){h=B.editoptions.value}}if(h){var H=document.createElement("select");H.style.width="100%";b(H).attr({name:B.index||B.name,id:"gs_"+B.name});var e,z,c;if(typeof h==="string"){e=h.split(";");for(var F=0;F<e.length;F++){z=e[F].split(":");c=document.createElement("option");c.value=z[0];c.innerHTML=z[1];H.appendChild(c)}}else{if(typeof h==="object"){for(var A in h){if(h.hasOwnProperty(A)){c=document.createElement("option");c.value=A;c.innerHTML=h[A];H.appendChild(c)}}}}if(G.defaultValue){b(H).val(G.defaultValue)}if(G.attr){b(H).attr(G.attr)}if(G.dataInit!==undefined){G.dataInit(H)}if(G.dataEvents!==undefined){n(H,G.dataEvents)}b(D).append(H);if(a.autosearch===true){b(H).change(function(q){l();return false})}}}break;case"text":var C=G.defaultValue?G.defaultValue:"";b(D).append("<input type='text' style='width:95%;padding:0px;' name='"+(B.index||B.name)+"' id='gs_"+B.name+"' value='"+C+"'/>");if(G.attr){b("input",D).attr(G.attr)}if(G.dataInit!==undefined){G.dataInit(b("input",D)[0])}if(G.dataEvents!==undefined){n(b("input",D)[0],G.dataEvents)}if(a.autosearch===true){if(a.searchOnEnter){b("input",D).keypress(function(r){var q=r.charCode?r.charCode:r.keyCode?r.keyCode:0;if(q==13){l();return false}return this})}else{b("input",D).keydown(function(r){var q=r.which;switch(q){case 13:return false;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:if(k){clearTimeout(k)}k=setTimeout(function(){l()},500)}})}}break}}b(g).append(D);b(p).append(g)});b("table thead",m.grid.hDiv).append(p);this.triggerToolbar=l;this.clearToolbar=o;this.toggleToolbar=j})}})})(jQuery);
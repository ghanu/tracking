(function(b){b.jgrid.extend({setSubGrid:function(){return this.each(function(){var e=this,a;e.p.colNames.unshift("");e.p.colModel.unshift({name:"subgrid",width:b.browser.safari?e.p.subGridWidth+e.p.cellLayout:e.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false,fixed:true});a=e.p.subGridModel;if(a[0]){a[0].align=b.extend([],a[0].align||[]);for(var f=0;f<a[0].name.length;f++){a[0].align[f]=a[0].align[f]||"left"}}})},addSubGridCell:function(g,i){var j="",h,a;this.each(function(){j=this.formatCol(g,i);h=this.p.gridview;a=this.p.id});if(h===false){return'<td role="grid" aria-describedby="'+a+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+j+"><a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a></td>"}else{return'<td role="grid" aria-describedby="'+a+'_subgrid" '+j+"></td>"}},addSubGrid:function(a,d){return this.each(function(){var z=this;if(!z.grid){return}var y,x,v,q,p,s,r;b("td:eq("+d+")",a).click(function(e){if(b(this).hasClass("sgcollapsed")){v=z.p.id;y=b(this).parent();q=d>=1?"<td colspan='"+d+"'>&#160;</td>":"";x=b(y).attr("id");r=true;if(b.isFunction(z.p.subGridBeforeExpand)){r=z.p.subGridBeforeExpand(v+"_"+x,x)}if(r===false){return false}p=0;b.each(z.p.colModel,function(f,g){if(this.hidden===true||this.name=="rn"||this.name=="cb"){p++}});s="<tr role='row' class='ui-subgrid'>"+q+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon ui-icon-carat-1-sw'/></td><td colspan='"+parseInt(z.p.colNames.length-1-p,10)+"' class='ui-widget-content subgrid-data'><div id="+v+"_"+x+" class='tablediv'>";b(this).parent().after(s+"</div></td></tr>");if(b.isFunction(z.p.subGridRowExpanded)){z.p.subGridRowExpanded(v+"_"+x,x)}else{c(y)}b(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-minus'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded")}else{if(b(this).hasClass("sgexpanded")){r=true;if(b.isFunction(z.p.subGridRowColapsed)){y=b(this).parent();x=b(y).attr("id");r=z.p.subGridRowColapsed(v+"_"+x,x)}if(r===false){return false}b(this).parent().next().remove(".ui-subgrid");b(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed")}}return false});var c=function(f){var g,j,e,h,i;j=b(f).attr("id");e={nd_:(new Date().getTime())};e[z.p.prmNames.subgridid]=j;if(!z.p.subGridModel[0]){return false}if(z.p.subGridModel[0].params){for(i=0;i<z.p.subGridModel[0].params.length;i++){for(h=0;h<z.p.colModel.length;h++){if(z.p.colModel[h].name==z.p.subGridModel[0].params[i]){e[z.p.colModel[h].name]=b("td:eq("+h+")",f).text().replace(/\&#160\;/ig,"")}}}}if(!z.grid.hDiv.loading){z.grid.hDiv.loading=true;b("#load_"+z.p.id).show();if(!z.p.subgridtype){z.p.subgridtype=z.p.datatype}if(b.isFunction(z.p.subgridtype)){z.p.subgridtype(e)}else{z.p.subgridtype=z.p.subgridtype.toLowerCase()}switch(z.p.subgridtype){case"xml":case"json":b.ajax(b.extend({type:z.p.mtype,url:z.p.subGridUrl,dataType:z.p.subgridtype,data:b.isFunction(z.p.serializeSubGridData)?z.p.serializeSubGridData(e):e,complete:function(k){if(z.p.subgridtype=="xml"){w(k.responseXML,j)}else{t(b.jgrid.parse(k.responseText),j)}k=null}},b.jgrid.ajaxOptions,z.p.ajaxSubgridOptions||{}));break}}return false};var u=function(g,h,e){var f=b("<td align='"+z.p.subGridModel[0].align[e]+"'></td>").html(h);b(g).append(f)};var w=function(e,g){var l,f,m,j,h=b("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),i=b("<tr></tr>");for(f=0;f<z.p.subGridModel[0].name.length;f++){l=b("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+z.p.direction+"'></th>");b(l).html(z.p.subGridModel[0].name[f]);b(l).width(z.p.subGridModel[0].width[f]);b(i).append(l)}b(h).append(i);if(e){j=z.p.xmlReader.subgrid;b(j.root+" "+j.row,e).each(function(){i=b("<tr class='ui-widget-content ui-subtblcell'></tr>");if(j.repeatitems===true){b(j.cell,this).each(function(o){u(i,b(this).text()||"&#160;",o)})}else{var n=z.p.subGridModel[0].mapping||z.p.subGridModel[0].name;if(n){for(f=0;f<n.length;f++){u(i,b(n[f],this).text()||"&#160;",f)}}}b(h).append(i)})}var k=b("table:first",z.grid.bDiv).attr("id")+"_";b("#"+k+g).append(h);z.grid.hDiv.loading=false;b("#load_"+z.p.id).hide();return false};var t=function(o,f){var m,k,e,n,j,g,h=b("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),i=b("<tr></tr>");for(e=0;e<z.p.subGridModel[0].name.length;e++){m=b("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+z.p.direction+"'></th>");b(m).html(z.p.subGridModel[0].name[e]);b(m).width(z.p.subGridModel[0].width[e]);b(i).append(m)}b(h).append(i);if(o){j=z.p.jsonReader.subgrid;k=o[j.root];if(typeof k!=="undefined"){for(e=0;e<k.length;e++){n=k[e];i=b("<tr class='ui-widget-content ui-subtblcell'></tr>");if(j.repeatitems===true){if(j.cell){n=n[j.cell]}for(g=0;g<n.length;g++){u(i,n[g]||"&#160;",g)}}else{var B=z.p.subGridModel[0].mapping||z.p.subGridModel[0].name;if(B.length){for(g=0;g<B.length;g++){u(i,n[B[g]]||"&#160;",g)}}}b(h).append(i)}}}var l=b("table:first",z.grid.bDiv).attr("id")+"_";b("#"+l+f).append(h);z.grid.hDiv.loading=false;b("#load_"+z.p.id).hide();return false};z.subGridXml=function(e,f){w(e,f)};z.subGridJson=function(e,f){t(e,f)}})},expandSubGridRow:function(a){return this.each(function(){var f=this;if(!f.grid&&!a){return}if(f.p.subGrid===true){var h=b(this).jqGrid("getInd",a,true);if(h){var g=b("td.sgcollapsed",h)[0];if(g){b(g).trigger("click")}}}})},collapseSubGridRow:function(a){return this.each(function(){var f=this;if(!f.grid&&!a){return}if(f.p.subGrid===true){var h=b(this).jqGrid("getInd",a,true);if(h){var g=b("td.sgexpanded",h)[0];if(g){b(g).trigger("click")}}}})},toggleSubGridRow:function(a){return this.each(function(){var f=this;if(!f.grid&&!a){return}if(f.p.subGrid===true){var h=b(this).jqGrid("getInd",a,true);if(h){var g=b("td.sgcollapsed",h)[0];if(g){b(g).trigger("click")}else{g=b("td.sgexpanded",h)[0];if(g){b(g).trigger("click")}}}}})}})})(jQuery);